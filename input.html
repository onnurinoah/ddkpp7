<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë³´ì´ëŠ”ë¼ë””ì˜¤ ì‹œì²­ì ì°¸ì—¬</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase ì„¤ì •
        const firebaseConfig = {
            apiKey: "AIzaSyA4f6lYwTUK8PxjnKb-jEXOXwWgj0KJdxo",
            authDomain: "ddkpp7.firebaseapp.com",
            projectId: "ddkpp7",
            storageBucket: "ddkpp7.firebasestorage.app",
            messagingSenderId: "710654878188",
            appId: "1:710654878188:web:125f72d75677dc8ac820c9",
            measurementId: "G-ZLJVX995JC"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. ëŒ“ê¸€ ì „ì†¡ í•¨ìˆ˜
        window.submitComment = () => {
            const nickname = document.getElementById('nickname').value;
            const text = document.getElementById('comment-input').value;
            if(!nickname || !text) return alert("ë‹‰ë„¤ì„ê³¼ ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            
            push(ref(db, 'comments'), { 
                nickname, 
                text, 
                timestamp: Date.now() 
            });
            document.getElementById('comment-input').value = '';
        };

        // 2. íˆ¬í‘œ í•¨ìˆ˜
        window.vote = (type) => {
            const voteRef = ref(db, `votes/${type}`);
            onValue(voteRef, (snapshot) => {
                const current = snapshot.val() || 0;
                set(ref(db, `votes/${type}`), current + 1);
            }, { onlyOnce: true });
        };

        // 3. ì‹¤ì‹œê°„ íˆ¬í‘œ ê²°ê³¼ ìˆ˜ì‹ 
        onValue(ref(db, 'votes'), (snapshot) => {
            const data = snapshot.val() || { o: 0, x: 0 };
            const total = (data.o || 0) + (data.x || 0);
            const oPercent = total === 0 ? 50 : Math.round((data.o / total) * 100);
            const xPercent = total === 0 ? 50 : 100 - oPercent;

            document.getElementById('o-count').innerText = data.o || 0;
            document.getElementById('x-count').innerText = data.x || 0;
            document.getElementById('o-bar').style.width = oPercent + '%';
            document.getElementById('x-bar').style.width = xPercent + '%';
        });

        // 4. ì‹¤ì‹œê°„ ëŒ“ê¸€ ëª©ë¡ ìˆ˜ì‹  (ìµœê·¼ 20ê°œ)
        const commentsRef = query(ref(db, 'comments'), limitToLast(20));
        onValue(commentsRef, (snapshot) => {
            const listArea = document.getElementById('comment-list');
            listArea.innerHTML = '';
            const data = snapshot.val();
            if (data) {
                // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
                Object.values(data).reverse().forEach(comment => {
                    const item = document.createElement('div');
                    item.className = "p-3 bg-gray-50 rounded-lg border border-gray-100 mb-2";
                    item.innerHTML = `
                        <div class="flex justify-between mb-1">
                            <span class="font-bold text-sm text-green-700">${comment.nickname}</span>
                            <span class="text-[10px] text-gray-400">${new Date(comment.timestamp).toLocaleTimeString()}</span>
                        </div>
                        <p class="text-sm text-gray-700">${comment.text}</p>
                    `;
                    listArea.appendChild(item);
                });
            }
        });
    </script>
</head>
<body class="bg-gray-100 flex justify-center min-h-screen">
    <div class="w-full max-w-md bg-white min-h-screen shadow-lg flex flex-col">
        
        <div class="p-6 pb-0">
            <h1 class="text-xl font-bold text-center text-gray-800 mb-6">ğŸ“» ë³´ì´ëŠ” ë¼ë””ì˜¤ ì°¸ì—¬</h1>
            
            <div class="bg-gray-50 p-4 rounded-2xl mb-6 border border-gray-200">
                <p class="text-center text-xs font-bold text-gray-500 mb-3">í˜„ì¬ íˆ¬í‘œ í˜„í™©</p>
                <div class="flex h-8 w-full rounded-full overflow-hidden mb-2 shadow-inner">
                    <div id="o-bar" class="bg-blue-500 flex items-center justify-center text-white text-xs font-bold transition-all duration-500" style="width: 50%">O</div>
                    <div id="x-bar" class="bg-red-500 flex items-center justify-center text-white text-xs font-bold transition-all duration-500" style="width: 50%">X</div>
                </div>
                <div class="flex justify-between text-sm font-bold px-2">
                    <span class="text-blue-600">O: <span id="o-count">0</span>í‘œ</span>
                    <span class="text-red-600">X: <span id="x-count">0</span>í‘œ</span>
                </div>
            </div>

            <div class="space-y-3 mb-6">
                <input id="nickname" type="text" placeholder="ë‹‰ë„¤ì„" 
                       class="w-full border border-gray-300 p-3 rounded-xl focus:ring-2 focus:ring-green-500 outline-none text-sm">
                <textarea id="comment-input" rows="2" placeholder="ì‚¬ì—°ì´ë‚˜ ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”" 
                          class="w-full border border-gray-300 p-3 rounded-xl focus:ring-2 focus:ring-green-500 outline-none text-sm"></textarea>
                <button onclick="submitComment()" 
                        class="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 active:scale-95 transition">ëŒ“ê¸€ ë“±ë¡</button>
            </div>

            <div class="flex gap-3 mb-8">
                <button onclick="vote('o')" 
                        class="flex-1 bg-blue-500 text-white py-4 rounded-2xl text-2xl font-black shadow-md active:scale-95 transition">O</button>
                <button onclick="vote('x')" 
                        class="flex-1 bg-red-500 text-white py-4 rounded-2xl text-2xl font-black shadow-md active:scale-95 transition">X</button>
            </div>
            
            <hr class="border-gray-100">
        </div>

        <div class="flex-1 p-6 pt-4 overflow-y-auto">
            <h2 class="text-sm font-bold text-gray-600 mb-4 flex items-center">
                <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse mr-2"></span>
                ì‹¤ì‹œê°„ ëŒ“ê¸€ ëª©ë¡
            </h2>
            <div id="comment-list" class="space-y-3">
                <p class="text-center text-gray-400 text-xs py-10">ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>
            </div>
        </div>
    </div>
</body>
</html>
